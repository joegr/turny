{% extends "base.html" %}

{% block title %}Teams - Tournament Manager{% endblock %}

{% block content %}
<div class="header-actions">
    <h1>Teams</h1>
    <button onclick="showRegisterForm()">+ Register Team</button>
</div>

<div id="messageContainer"></div>

<div id="registerForm" class="section" style="display: none;">
    <h2>Register New Team</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Captain Name</label>
            <input type="text" id="captainName" placeholder="Enter captain name" style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px;">
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Team Name</label>
            <input type="text" id="teamName" placeholder="Enter team name" style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px;">
        </div>
        <div>
            <button onclick="registerTeam()">Register</button>
            <button class="btn-secondary" onclick="hideRegisterForm()">Cancel</button>
        </div>
    </div>
</div>

<div class="grid" id="teamsList">
    <div class="empty-state">Loading teams...</div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function showMessage(msg, isError = false) {
        const container = document.getElementById('messageContainer');
        container.innerHTML = `<div class="message ${isError ? 'message-error' : 'message-success'}">${msg}</div>`;
        setTimeout(() => container.innerHTML = '', 3000);
    }

    function showRegisterForm() {
        document.getElementById('registerForm').style.display = 'block';
    }

    function hideRegisterForm() {
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('captainName').value = '';
        document.getElementById('teamName').value = '';
    }

    async function registerTeam() {
        const captainName = document.getElementById('captainName').value.trim();
        const teamName = document.getElementById('teamName').value.trim();

        if (!captainName || !teamName) {
            showMessage('Please fill in all fields', true);
            return;
        }

        try {
            const response = await fetch('/api/teams/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ captain_name: captainName, team_name: teamName })
            });

            if (response.ok) {
                showMessage('Team registered successfully!');
                hideRegisterForm();
                loadTeams();
            } else {
                const data = await response.json();
                showMessage(data.error || 'Failed to register team', true);
            }
        } catch (error) {
            showMessage('Error registering team', true);
        }
    }

    async function loadTeams() {
        try {
            const response = await fetch('/api/teams');
            const teams = await response.json();

            const container = document.getElementById('teamsList');

            if (Object.keys(teams).length === 0) {
                container.innerHTML = '<div class="empty-state">No teams registered yet.</div>';
                return;
            }

            container.innerHTML = Object.entries(teams).map(([teamId, team]) => `
                <a href="/teams/${teamId}" class="card" style="text-decoration: none; color: inherit;">
                    <div class="card-title">${team.name}</div>
                    <div class="card-subtitle">Captain: ${team.captain}</div>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" style="color: #10b981;">${team.wins}</div>
                            <div class="stat-label">Wins</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #ef4444;">${team.losses}</div>
                            <div class="stat-label">Losses</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${team.wins + team.losses > 0 ? Math.round(team.wins / (team.wins + team.losses) * 100) : 0}%</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                    </div>
                </a>
            `).join('');
        } catch (error) {
            console.error('Error loading teams:', error);
        }
    }

    loadTeams();
</script>
{% endblock %}
